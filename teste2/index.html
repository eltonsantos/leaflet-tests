<!DOCTYPE html>
<html>
<head>	
	<title>GeoJSON tutorial - Leaflet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="stylesheet" href="css/jquery-ui.min.css" />
    <link rel="stylesheet" href="leaflet.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />

	<style>
		html, body {
			height: 100%;
			margin: 0;
		}

		.resultado {
			height: 80px;
		}

		#map {
			height: 800px;
		}
	</style>
	
</head>
<body>

	<br />

	<div class="container">
		<div class="row">
			<form>
				<div class="col-sm-11">
					<input type="text" name="busca" id="txtSearch" class="form-control" placeholder="Buscar..." />
				</div>
				<button class="btn btn-default" id="btnSearch"><i class="fa fa-search"></i></button>
			</form>

			<div class="resultado"></div>
			<div class="erro"></div>

		</div>


		<div id='map'></div>

	</div>

	<script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="leaflet.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/rede_agua.js" type="text/javascript"></script>
	<script src="js/geoHidrantes.js" type="text/javascript"></script>
	<script src="js/geoSetoresComerciais.js" type="text/javascript"></script>

	<script>

		var map;
		var objBasemaps;
		var objSobrecamadas;
		var controleCamadas;
		var camadaMapa;
		var stComerciaisLayer;
		var redeAguaLayer;
		var hidrantesLayer;
		var layerStComerciais;
		var popupConteudoStComerciais;
		var stComerciaisIDs = [];
		//var paises = ["Alemanha", "Argentina", "Brasil", "França", "Itália"];


		$(function(){
			map = L.map('map', {
				center: [-3.794, -38.545],
				zoom: 12,
				maxZoom: 18,
				minZoom: 7
			});
		
			camadaMapa = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
					'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery © <a href="http://mapbox.com">Mapbox</a>',
				id: 'mapbox.light'
			}).addTo(map);


			function onEachFeature(feature, layerStComerciais) {
				popupConteudoStComerciais = "<b>Setor Comercial: </b>" + feature.properties.sco_dsc_loc;
				
				layerStComerciais.bindPopup(popupConteudoStComerciais);

				layerStComerciais.on({
					click: zoomStComercial
				});
			}

			function zoomStComercial(e){
				map.fitBounds(e.target.getBounds());
			}

			/** ST COMERCIAIS */
			stComerciaisLayer = L.geoJSON(setoresComerciais, {
				style: function (feature) {
					return {
						color: "#999",
						fillColor: "#f90"
						//,feature.properties && feature.properties.style
					};
				},
				onEachFeature: onEachFeature,
				pointToLayer: function (feature, latlng) {
					return L.circleMarker(latlng, {
						radius: 8,
						fillColor: "#ff7800",
						color: "#000",
						weight: 1,
						opacity: 1,
						fillOpacity: 0.8
					});
				}
			}).addTo(map);


			/** REDES ÁGUA */
			redeAguaLayer = L.geoJSON(rede_agua, {
				style: function (feature) {
					return feature.properties && feature.properties.style;
				},
				onEachFeature: onEachFeature,
				pointToLayer: function (feature, latlng) {
					return L.circleMarker(latlng, {
						radius: 8,
						fillColor: "#ff7800",
						color: "#000",
						weight: 1,
						opacity: 1,
						fillOpacity: 0.8
					});
				}
			}).addTo(map);
			/*********************/

			/** HIDRANTES */
			hidrantesLayer = L.geoJSON(hidrantes, {
				filter: function (feature, layer) {
					if (feature.properties) {
						// If the property "underConstruction" exists and is true, return false (don't render features under construction)
						return feature.properties.underConstruction !== undefined ? !feature.properties.underConstruction : true;
					}
					return false;
				},
				onEachFeature: onEachFeature
			}).addTo(map);
			/*********************/

			//console.log(typeof(hidrantesLayer));

			objBasemaps = {
				"Mapa tradicional": camadaMapa
			};


			objSobrecamadas = {
				'Setores Comerciais': stComerciaisLayer,
				'Redes de Água': redeAguaLayer,
				'Hidrantes': hidrantesLayer
			};


			controleCamadas = L.control.layers(objBasemaps, objSobrecamadas).addTo(map);


			/* BUSCAR */
			$("#txtSearch").autocomplete({
				source: setoresComerciais.features.map(function(d){
					return d.properties.sco_num_sc + " - " + d.properties.sco_dsc_loc
				}),
				select: function(event, ui){
					console.log(stComerciaisLayer);
					console.log(map.fitBounds(stComerciaisLayer.getBounds(ui.item.value)));
					//map.fitBounds(stComerciaisLayer.getBounds(ui.item.value));
				} 
			});
			

		});

	</script>

</body>
</html>